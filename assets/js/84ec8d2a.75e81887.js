"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[49],{3905:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return p}});var r=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=r.createContext({}),c=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},h=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),h=c(n),p=i,m=h["".concat(l,".").concat(p)]||h[p]||u[p]||a;return n?r.createElement(m,o(o({ref:t},d),{},{components:n})):r.createElement(m,o({ref:t},d))}));function p(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,o=new Array(a);o[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,o[1]=s;for(var c=2;c<a;c++)o[c]=n[c];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}h.displayName="MDXCreateElement"},3725:function(e,t,n){n.r(t),n.d(t,{assets:function(){return d},contentTitle:function(){return l},default:function(){return p},frontMatter:function(){return s},metadata:function(){return c},toc:function(){return u}});var r=n(3117),i=n(102),a=(n(7294),n(3905)),o=["components"],s={id:"certifydns",title:"Certify DNS"},l="Certify DNS",c={unversionedId:"dns/providers/certifydns",id:"dns/providers/certifydns",title:"Certify DNS",description:"Certify DNS is a cloud hosted version of the acme-dns standard (CNAME delegation of acme challenge TXT records to a dedicated challenge response service). This service can be enabled through the https://certifytheweb.com License Keys tab when signed in. The service is compatible with most existing acme-dns clients so it can be used with other ACME clients on all operating systems.",source:"@site/docs/dns/providers/certifydns.md",sourceDirName:"dns/providers",slug:"/dns/providers/certifydns",permalink:"/docs/dns/providers/certifydns",draft:!1,editUrl:"https://github.com/webprofusion/certify-docs/edit/master/docs/dns/providers/certifydns.md",tags:[],version:"current",frontMatter:{id:"certifydns",title:"Certify DNS"}},d={},u=[{value:"Using Certify DNS in Certify The Web",id:"using-certify-dns-in-certify-the-web",level:2},{value:"Using Certify DNS with other acme-dns compatible clients",id:"using-certify-dns-with-other-acme-dns-compatible-clients",level:2},{value:"Example: Certbot with acme-dns-auth.py (linux)",id:"example-certbot-with-acme-dns-authpy-linux",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Sharing CNAME registrations across multiple machines",id:"sharing-cname-registrations-across-multiple-machines",level:2},{value:"Migrating from acme-dns to Certify DNS or vice-versa",id:"migrating-from-acme-dns-to-certify-dns-or-vice-versa",level:2},{value:"Securing Issuance",id:"securing-issuance",level:2},{value:"Advantages and Disadvantages",id:"advantages-and-disadvantages",level:2},{value:"Planned Pricing",id:"planned-pricing",level:2}],h={toc:u};function p(e){var t=e.components,n=(0,i.Z)(e,o);return(0,a.kt)("wrapper",(0,r.Z)({},h,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"certify-dns"},"Certify DNS"),(0,a.kt)("p",null,"Certify DNS is a cloud hosted version of the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/joohoi/acme-dns"},"acme-dns")," standard (CNAME delegation of acme challenge TXT records to a dedicated challenge response service). This service can be enabled through the ",(0,a.kt)("a",{parentName:"p",href:"https://certifytheweb.com"},"https://certifytheweb.com")," License Keys tab when signed in. The service is compatible with most existing ",(0,a.kt)("em",{parentName:"p"},"acme-dns")," clients so it can be used with other ACME clients on all operating systems."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"With Certify DNS, you create a special CNAME record in your domain DNS, instead of a TXT record. This CNAME record points to the Certify DNS cloud service and handles ACME challenge responses for your domain.")),(0,a.kt)("h2",{id:"using-certify-dns-in-certify-the-web"},"Using Certify DNS in Certify The Web"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Enable Certify DNS in your ",(0,a.kt)("a",{parentName:"li",href:"https://certifytheweb.com"},"https://certifytheweb.com")," profile (under License Keys). While the service is in beta testing this can be enabled for free."),(0,a.kt)("li",{parentName:"ul"},"Select Certify DNS as the DNS update method."),(0,a.kt)("li",{parentName:"ul"},"Create your Certify DNS credentials using your account email address (as ",(0,a.kt)("inlineCode",{parentName:"li"},"API Username"),") and license key (as ",(0,a.kt)("inlineCode",{parentName:"li"},"API Key"),"). You only need to do this once."),(0,a.kt)("li",{parentName:"ul"},"Click ",(0,a.kt)("inlineCode",{parentName:"li"},"Request Certificate")," to perform a one-time registration with the Certify DNS service (per domain)."),(0,a.kt)("li",{parentName:"ul"},"You will be prompted to create a CNAME pointing to the TXT record hosted by the Certify DNS service. If you miss this prompt check back in the log file for your managed certificate (see the Status tab)."),(0,a.kt)("li",{parentName:"ul"},"Once you have created your CNAME record, delete any existing ","_","acme-challenge TXT record in the same zone to avoid confusion."),(0,a.kt)("li",{parentName:"ul"},"Resume the request using ",(0,a.kt)("inlineCode",{parentName:"li"},"Request Certificate"),", the Certify DNS service will automatically provide the required TXT record responses on your behalf."),(0,a.kt)("li",{parentName:"ul"},"Automatic renewals will then perform this process again without manual intervention.")),(0,a.kt)("h2",{id:"using-certify-dns-with-other-acme-dns-compatible-clients"},"Using Certify DNS with other acme-dns compatible clients"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Once activated on your ",(0,a.kt)("a",{parentName:"li",href:"https://certifytheweb.com"},"https://certifytheweb.com")," account as special URL will be shown under the License Keys tab. This passes your license key info as basic credentials to the Certify DNS service."),(0,a.kt)("li",{parentName:"ul"},"Follow the normal instructions for your acme-dns client, using the provided URL as the base URL for the acme-dns service.")),(0,a.kt)("h3",{id:"example-certbot-with-acme-dns-authpy-linux"},"Example: Certbot with acme-dns-auth.py (linux)"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Install Certbot and download acme-dns-auth.py (",(0,a.kt)("a",{parentName:"li",href:"https://github.com/joohoi/acme-dns-certbot-joohoi"},"https://github.com/joohoi/acme-dns-certbot-joohoi"),")"),(0,a.kt)("li",{parentName:"ul"},"Update acme-dns-auth.py to set ",(0,a.kt)("inlineCode",{parentName:"li"},'ACMEDNS_URL = "https://<your key credentials>@certify-dns.certifytheweb.com"'),". Your url with credentials if found on your certifytheweb.com License Keys tab when Certify DNS is enabled."),(0,a.kt)("li",{parentName:"ul"},"Run certbot with the required auth hook, e.g.:\n",(0,a.kt)("inlineCode",{parentName:"li"},"sudo certbot certonly --manual --manual-auth-hook /etc/letsencrypt/acme-dns-auth.py --preferred-challenges dns --debug-challenges -d www.example.com")),(0,a.kt)("li",{parentName:"ul"},"On first run you will be prompted to create a specific CNAME in your domains DNS after registration completes.")),(0,a.kt)("h2",{id:"troubleshooting"},"Troubleshooting"),(0,a.kt)("p",null,"If the error in the app is ",(0,a.kt)("inlineCode",{parentName:"p"},"NXDOMAIN for _acme-challenge...")," , the Certificate Authority has been unable to find or follow the CNAME you have configured in your DNS."),(0,a.kt)("h2",{id:"sharing-cname-registrations-across-multiple-machines"},"Sharing CNAME registrations across multiple machines"),(0,a.kt)("p",null,"If you need to have multiple machines fetch certificates for the same domain (such as a wildcard cert) you will find that your CNAME record needs to be the same Certify DNS pointer, which in turn means you need to share the Certify DNS registration config across each machine. To do this, copy the respective config file from C:\\ProgramData\\certify\\acmedns\\ on one machine all of to the other machines. Thereafter their renewals will all use the same Certify DNS registration for that domain."),(0,a.kt)("h2",{id:"migrating-from-acme-dns-to-certify-dns-or-vice-versa"},"Migrating from acme-dns to Certify DNS or vice-versa"),(0,a.kt)("p",null,"To switch from acme-dns to Certify DNS, first delete the respective domain config from C:\\ProgramData\\certify\\acmedns and switch the DNS provider to Certify DNS, then wait 1 month (or 30 days since the last renewal) to allow the previous domain validation to expire at the CA. Thereafter, perform a normal renewal (or let the app auto renew) - this will fail until the new CNAME registration has been completed, so check the log for this managed certificate and find the new CNAME value you need to populate, then renew normally."),(0,a.kt)("h2",{id:"securing-issuance"},"Securing Issuance"),(0,a.kt)("p",null,"Delegating DNS validation to an external service theoretically allows the service to complete validation for certificates on your domain. To guard against issuance by a different account some CAs implement the CAA extensions for RFC8657 ",(0,a.kt)("a",{parentName:"p",href:"https://datatracker.ietf.org/doc/html/rfc8657"},"https://datatracker.ietf.org/doc/html/rfc8657")),(0,a.kt)("p",null,"For example, to restrict specific-domain issuance (for non-wildcard certs) to letsencrypt.org only when using account 1234 and only using DNS validation (dns-01), add a CAA record with the account URI and validation method set :\n",(0,a.kt)("inlineCode",{parentName:"p"},'CAA 0 issue "letsencrypt.org; accounturi=https://acme-v02.api.letsencrypt.org/acme/acct/1234; validationmethods=dns-01"')),(0,a.kt)("p",null,"To restrict wildcard issuance use ",(0,a.kt)("inlineCode",{parentName:"p"},"issuewild"),":\n",(0,a.kt)("inlineCode",{parentName:"p"},'CAA 0 issuewild "letsencrypt.org; accounturi=https://acme-v02.api.letsencrypt.org/acme/acct/1234; validationmethods=dns-01"')),(0,a.kt)("p",null,"This feature requires support from your chosen CA. Your CA account URI is available from the Certify command line using ",(0,a.kt)("inlineCode",{parentName:"p"},"certify acmeaccount list"),"."),(0,a.kt)("h2",{id:"advantages-and-disadvantages"},"Advantages and Disadvantages"),(0,a.kt)("p",null,"There are a number of factors to consider before delegating validation to a service like Certify DNS (or any acme-dns style service)."),(0,a.kt)("p",null,"Advantages:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Easy setup and can be used with any DNS provider even if they don't have an API"),(0,a.kt)("li",{parentName:"ul"},"Least privileged updates to DNS. Your existing DNS zone only needs initial CNAME records created and thereafter no further updates are required to your DNS.")),(0,a.kt)("p",null,"Disadvantages:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Delegating DNS validation to an external service theoretically allows the service to complete validation for certificates on your domain. ",(0,a.kt)("strong",{parentName:"li"},"This is a security risk and you must trust the service provider.")," An alternative is to host your own internet facing acme-dns server. You should review the requirements for doing that and assess whether it's the best choice for your organisation. Your CA can implement ",(0,a.kt)("a",{parentName:"li",href:"https://datatracker.ietf.org/doc/html/rfc8657"},"https://datatracker.ietf.org/doc/html/rfc8657")," issuance features for the DNS CAA record standard adds a way to limit updates to only be performed by specific CA accounts.")),(0,a.kt)("h2",{id:"planned-pricing"},"Planned Pricing"),(0,a.kt)("p",null,"Certify DNS is a commercial service. Current planned pricing when the service leaves beta is:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Type"),(0,a.kt)("th",{parentName:"tr",align:null},"Renewal Frequency"),(0,a.kt)("th",{parentName:"tr",align:null},"Domains"),(0,a.kt)("th",{parentName:"tr",align:null},"Price"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Standard"),(0,a.kt)("td",{parentName:"tr",align:null},"Monthly"),(0,a.kt)("td",{parentName:"tr",align:null},"500"),(0,a.kt)("td",{parentName:"tr",align:null},"$4.99 USD")))),(0,a.kt)("p",null,"Currently, this is planned as an Azure Marketplace SaaS subscription."))}p.isMDXComponent=!0}}]);