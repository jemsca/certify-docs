<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-script-hooks">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-rc.1">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RLGYG5TYY5"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-RLGYG5TYY5",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Certify The Web Docs" href="/opensearch.xml"><title data-rh="true">Scripting | Certify The Web Docs</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.certifytheweb.com/docs/script-hooks"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Scripting | Certify The Web Docs"><meta data-rh="true" name="description" content="Certify is extensible via PowerShell scripts tasks which can be configured to run before or after the Certificate Request. From v5 onwards these are found under the Tasks tab for your managed certificate. See Tasks for more information."><meta data-rh="true" property="og:description" content="Certify is extensible via PowerShell scripts tasks which can be configured to run before or after the Certificate Request. From v5 onwards these are found under the Tasks tab for your managed certificate. See Tasks for more information."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.certifytheweb.com/docs/script-hooks"><link data-rh="true" rel="alternate" href="https://docs.certifytheweb.com/docs/script-hooks" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.certifytheweb.com/docs/script-hooks" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://YX7T7PF7BX-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.483ab3f2.css">
<link rel="preload" href="/assets/js/runtime~main.5a0f8692.js" as="script">
<link rel="preload" href="/assets/js/main.cb2383f5.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Certify The Web Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="Certify The Web Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Certify The Web - Docs</b></a><a class="navbar__item navbar__link" href="/docs/intro">Getting Started</a><a class="navbar__item navbar__link" href="/docs/faq">FAQ</a><a class="navbar__item navbar__link" href="/docs/support">Support</a></div><div class="navbar__items navbar__items--right"><a href="https://community.certifytheweb.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Community<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://certifytheweb.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">certifytheweb.com<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Introduction</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/intro">Getting Started</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/installation">Installation &amp; Upgrades</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/certificate-process">Requesting a Certificate</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/renewals">Certificate Renewals</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active">Guides</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" tabindex="0" href="/docs/guides/certificate-authorities">Background Information</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/certificate-authorities">Certificate Authorities</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/certificates">Certificates</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/http-validation">HTTP Validation (http-01)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/dns/validation">DNS Validation (dns-01)</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/deployment/tasks_intro">Advanced Deployment</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/deployment/tasks_intro">Deployment Tasks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/script-hooks">Scripting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/architecture/load-balancing">Load Balanced Hosting</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" tabindex="0" href="/docs/guides/csr">General</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/csr">Certificate Signing Requests</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Useful Info</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/best-practices">Best Practices</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/ssl-windows">Using Certificates in Windows</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/commandline">Command Line (CLI)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/csv-import">CSV Bulk Import</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/backgroundservice">Background Service</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Support</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/licensing">Licensing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/faq">Frequently Asked Questions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/support">Support Options</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Guides</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Advanced Deployment</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Scripting</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Scripting</h1><p>Certify is extensible via PowerShell scripts tasks which can be configured to run before or after the Certificate Request. From v5 onwards these are found under the Tasks tab for your managed certificate. See <a href="/docs/deployment/tasks_intro">Tasks</a> for more information.</p><p>The scripts are provided a parameter <code>$result</code> which contains the status and details of the managed certificate being requested. You can execute any commands including creating new processes, or using other command line tools. </p><p>A common use for scripting is to use your new certificate for services other than IIS websites, such as Microsoft Exchange, RDP Gateway, FTP servers and other services. The app also has a range of built-in deployment tasks which also use scripting internally.</p><p><em>By default the background service runs as Local System, so your scripts will execute in that context</em>, this can be important for issues regarding permissions, file system encryption etc. You can optionally configure your task to run as a specific user if network access or special permissions are required.</p><p><strong>Do not store scripts under the C:\Program Files\CertifyTheWeb<!-- -->*<!-- --> folder. File stored there will be deleted next time you update the app</strong></p><p>All scripts should be refined and tested in a staging environment before use in production.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="scripting-basics">Scripting Basics<a class="hash-link" href="#scripting-basics" title="Direct link to heading">​</a></h2><p>Here is a sample PowerShell script which demonstrates a few commonly accessed pieces of information:</p><div class="language-PowerShell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-PowerShell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">param($result)   # required to access the $result parameter</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># either $true or $false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$result.IsSuccess</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># object containing all information Certify has about the saved Site</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$result.ManagedItem</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># the IIS (or other service) site ID</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$result.ManagedItem.ServerSiteId   # ex: 1, 2, 3, ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># the website root directory (if applicable)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$result.ManagedItem.RequestConfig.WebsiteRootPath   # ex: &quot;C:\inetpub\wwwroot&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># the path to the created/renewed certificate PFX file</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$result.ManagedItem.CertificatePath   # ex: &quot;C:\ProgramData\Certify\certes\assets\pfx\00f9e07e-83ca-4029-a173-4b704ee78996.pfx&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># the certificate thumbprint</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$result.ManagedItem.CertificateThumbprintHash # ex: &quot;78b1080a1bf5e7fc0bbb0c0614fc4a18932db5f9&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># the previous certificate thumbprint</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$result.ManagedItem.CertificatePreviousThumbprintHash  # ex: &quot;18c1060a1be5e6fc0bbb0c0614fc4a18932db5fa&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># You can set $result.Abort to $true in a pre-request hook to prevent the certificate from</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># being requested (has no effect in post-request hooks)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$result.Abort = $false</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>$result.ManagedItem</code> object is an instance of the <a href="https://github.com/webprofusion/certify/blob/development/src/Certify.Models/Config/ManagedCertificate.cs" target="_blank" rel="noopener noreferrer">ManagedCertificate</a> class, so all of the properties it has will be available in your script:</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="pre-request-tasks">Pre-Request Tasks<a class="hash-link" href="#pre-request-tasks" title="Direct link to heading">​</a></h2><p>Notes: Pre-request scripts/tasks are executed immediately before the Certificate Request is about to be made (including the challenge file configuration checks).</p><ul><li>The <code>$result.IsSuccess</code> value will always be <code>$false</code>.</li><li>If for some reason your script would like to prevent the Certificate Request from being executed, you may set <code>$result.Abort</code> to <code>$true</code> and the site your script was executed for will be skipped.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="deployment-tasks-post-request">Deployment Tasks (Post-Request)<a class="hash-link" href="#deployment-tasks-post-request" title="Direct link to heading">​</a></h2><p>Deployment task (post-request) scripts are executed immediately after the Certificate Request was completed, and the certificate was automatically installed and configured according to the site configuration within Certify.</p><p>By default these run if the request was successful but you can change the task trigger (On Success, On Fail, etc). You can also configure them for manual execution only, so that you can perform them during a maintenance window, or via a windows scheduled task using the command line.</p><ul><li>The <code>$result.IsSuccess</code> value indicates whether or not the Certificate Request was successfully completed.</li><li>The <code>$result.Message</code> value provides a message describing the reason for failure, or a message indicating success.</li></ul><p>Legacy uses for scripting (v4.x and lower) may have previously included CCS Export, PEM file creation etc however these functions are provided by built-in Deployment Tasks which you should use instead unless the built-in functionality does not meet your requirements.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-output-the-result-properties-to-a-text-file">Example: Output the result properties to a text file<a class="hash-link" href="#example-output-the-result-properties-to-a-text-file" title="Direct link to heading">​</a></h3><div class="language-PowerShell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-PowerShell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Logs results to the given path (modify as required)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">param($result)  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$logpath = &quot;c:\temp\ps-test.txt&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$date = Get-Date</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Add-Content $logpath (&quot;-------------------------------------------------&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Add-Content $logpath (&quot;Script Run Date: &quot; + $date)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Add-Content $logpath ($result | ConvertTo-Json)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-send-email-via-gmail-after-unsuccessful-renewal">Example: Send email via Gmail after unsuccessful renewal<a class="hash-link" href="#example-send-email-via-gmail-after-unsuccessful-renewal" title="Direct link to heading">​</a></h3><p><em>Note: this is an example only, by default the app will use the certifytheweb.com API to notify you of repeated failures.</em></p><div class="language-PowerShell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-PowerShell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">param($result)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if (!$result.IsSuccess) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   $EmailFrom = &quot;username@gmail.com&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   $EmailTo = &quot;username@gmail.com&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   $Subject = &quot;Cert Request Failed: &quot; + $result.ManagedItem.RequestConfig.PrimaryDomain</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   $Body = &quot;Error: &quot; + $result.Message</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   $SMTPServer = &quot;smtp.gmail.com&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   $SMTPClient = New-Object Net.Mail.SmtpClient($SmtpServer, 587)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   $SMTPClient.EnableSsl = $true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   $SMTPClient.Credentials = New-Object System.Net.NetworkCredential(&quot;username@gmail.com&quot;, &quot;password&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   $SMTPClient.Send($EmailFrom, $EmailTo, $Subject, $Body)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   write-output &quot;Sent notification email&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-restart-rras-after-successful-certificate-renewal">Example: Restart RRAS after successful certificate renewal<a class="hash-link" href="#example-restart-rras-after-successful-certificate-renewal" title="Direct link to heading">​</a></h3><div class="language-PowerShell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-PowerShell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">param($result)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if ($result.IsSuccess -and $result.ManagedItem.GroupId -eq 1) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   write-output &quot;Restarting RRAS...&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   Net Stop RemoteAccess</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   Net Start RemoteAccess</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   write-output &quot;Done&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-convert-cng-certificate-storage-to-csp-for-exchange-2013">Example: Convert CNG certificate storage to CSP (for Exchange 2013)<a class="hash-link" href="#example-convert-cng-certificate-storage-to-csp-for-exchange-2013" title="Direct link to heading">​</a></h3><div class="language-PowerShell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-PowerShell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">param($result)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$tempfile = &quot;$env:TEMP\CertifyTemp.pfx&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$pfx = get-pfxcertificate -filepath $result.ManagedItem.CertificatePath</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">certutil -f -p Certify -exportpfx $pfx.SerialNumber $tempfile</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">certutil -delstore my $pfx.SerialNumber</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">certutil -p Certify -csp &quot;Microsoft RSA SChannel Cryptographic Provider&quot; -importpfx $tempfile</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">remove-item $tempfile</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-enable-certificate-for-exchange-2013--2016-services-on-local-server">Example: Enable certificate for Exchange 2013 / 2016 services on local server<a class="hash-link" href="#example-enable-certificate-for-exchange-2013--2016-services-on-local-server" title="Direct link to heading">​</a></h3><div class="language-PowerShell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-PowerShell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">param($result)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Enable-ExchangeCertificate -Thumbprint $result.ManagedItem.CertificateThumbprintHash -Services POP,IMAP,SMTP,IIS -Force</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-update-vmware-horizon-certificate">Example: Update VMWare Horizon certificate<a class="hash-link" href="#example-update-vmware-horizon-certificate" title="Direct link to heading">​</a></h3><p>This example removes any previous certificate with the same FriendlyName (<code>vdm</code>) then renames the Friendly Name property of the new certificate to <code>vmd</code>. It then restarts the <code>wstunnel</code> service.</p><div class="language-PowerShell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-PowerShell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">param($result)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if ($result.IsSuccess) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   $thumbprint = $result.ManagedItem.CertificateThumbprintHash # e.g. 2c127d49b4f63d947dd7b91750c9e57751eced0c</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   # remove the old cert (by Friendly Name &#x27;vdm&#x27;) to avoid duplication, if it exists</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   Get-ChildItem -Path cert:\LocalMachine\My | Where {$_.FriendlyName.Equals(&quot;vdm&quot;)} | Remove-Item</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   # rename our new certificate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   $cert = Get-ChildItem -Path cert:\LocalMachine\My\$thumbprint</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   $cert.FriendlyName =&quot;vdm&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   # restart the wstunnel service to apply certificate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   Restart-Service wstunnel -Force -ErrorAction Stop</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="example-update-certificate-for-sstp-vpn">Example: Update certificate for SSTP VPN<a class="hash-link" href="#example-update-certificate-for-sstp-vpn" title="Direct link to heading">​</a></h4><div class="language-PowerShell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-PowerShell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">param($result)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Store certificate in variable</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$cert = Get-ChildItem -Path Cert:\LocalMachine\My | Where-Object {$_.Thumbprint -match $result.ManagedItem.CertificateThumbprintHash}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Stop RRAS, set cert, start RRAS</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Import-Module RemoteAccess</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Stop-Service RemoteAccess</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Set-RemoteAccess -SslCertificate $cert</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Start-Service RemoteAccess</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-update-sql-server-connection-certificate">Example: Update SQL Server connection certificate<a class="hash-link" href="#example-update-sql-server-connection-certificate" title="Direct link to heading">​</a></h3><p>This example updates the registry key for the SQL Server certificate thumbprint. Note that the instance name will affect the name of the registry key, so you need to find that and change that in the script. Some SQL Server editions may also require the certificate key to be converted to the older RSA SChannel CSP.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">param($result)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Example script to set SQL Server certificate </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Note that some instances of SQL server may require certificate key storage to use the &quot;Microsoft RSA SChannel Cryptographic Provider&quot; </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># See an example conversion: https://docs.certifytheweb.com/docs/script-hooks#example-convert-cng-certificate-storage-to-csp-for-exchange-2013</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># See HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Microsoft SQL Server\ for the required instance key</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$instanceKey = &#x27;MSSQL15.MSSQLSERVER&#x27;  # Change this as required</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># -------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$registryPath = &quot;Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Microsoft SQL Server\$instanceKey\MSSQLServer\SuperSocketNetLib&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$oldthumbprint = (Get-Itemproperty -Path $registryPath).Certificate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$newthumbprint = $result.ManagedItem.CertificateThumbprintHash</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if ($oldthumb -ne $newthumb) { </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # apply the new certificate thumbprint to the registry key</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Set-ItemProperty -Path $registryPath -Name &#x27;Certificate&#x27; -Value $newthumb</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # optionally restart the SQL service (uncomment if required in this step), correct service name may vary</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # Restart-Service mssqlserver</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-update-sql-server-reporting-services">Example: Update SQL Server Reporting Services<a class="hash-link" href="#example-update-sql-server-reporting-services" title="Direct link to heading">​</a></h3><p>This is adapted from a community example: <a href="https://community.certifytheweb.com/t/sql-server-reporting-services-ssrs/332/7" target="_blank" rel="noopener noreferrer">https://community.certifytheweb.com/t/sql-server-reporting-services-ssrs/332/7</a>  </p><p>This script gets the report server config object the checks if an existing cert is bound it removes that, then creates the new binding.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">param($result)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ssrsServerName = &quot;RS_MSSQLSERVER&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ssrsReportManagerName = &quot;ReportManager&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ssrsReportWebServiceName = &quot;ReportServerWebService&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$httpsPort = 443</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ipAddress = &quot;0.0.0.0&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Find the ssrsServerName by running:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Get-WmiObject -namespace root\Microsoft\SqlServer\ReportServer -class __Namespace</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># take the value of the name field</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$version = (Get-WmiObject –namespace root\Microsoft\SqlServer\ReportServer\$ssrsServerName  –class __Namespace).Name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$rsConfig = Get-WmiObject –namespace &quot;root\Microsoft\SqlServer\ReportServer\$ssrsServerName\$version\Admin&quot; -class MSReportServer_ConfigurationSetting</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># the cert thumbnail of the newest certificate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$newthumb = $result.ManagedItem.CertificateThumbprintHash.ToLower()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># check the cert thumbnail of the currently bound certificate (if any)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$oldthumb = &#x27;&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">try {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   $oldthumb = $rsConfig.ListSSLCertificateBindings(1033).CertificateHash.Item([array]::LastIndexOf($rsConfig.ListSSLCertificateBindings(1033).Application, $ssrsReportManagerName))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   if ($oldthumb -ne $newthumb) {      </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      $rsConfig.RemoveSSLCertificateBindings($ssrsReportManagerName, $oldthumb, $ipAddress, $httpsport, 1033) </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      $rsConfig.RemoveSSLCertificateBindings($ssrsReportWebServiceName, $oldthumb, $ipAddress, $httpsport, 1033)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">} catch {}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$rsConfig.CreateSSLCertificateBinding($ssrsReportManagerName, $newthumb, $ipAddress, $httpsport, 1033)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$rsConfig.CreateSSLCertificateBinding($ssrsReportWebServiceName, $newthumb, $ipAddress, $httpsport, 1033) </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-update-the-certificate-on-a-local-winrm-https-listener-windows-admin-center-etc">Example: Update the certificate on a local WinRM https listener (Windows Admin Center etc)<a class="hash-link" href="#example-update-the-certificate-on-a-local-winrm-https-listener-windows-admin-center-etc" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">param($result)  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># update the local winrm https listener cert, assumes the cert is already installed to local computer certificate store using Certify</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># based on https://serverfault.com/questions/589607/automatically-reconfigure-winrm-https-listener-with-new-certificate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Set-Location -Path WSMan:\localhost\Service</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Set-Item -Path .\CertificateThumbprint -Value $result.ManagedItem.CertificateThumbprintHash</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-convert-pfx-to-java-key-store-using-keytool">Example: Convert PFX to Java Key Store using keytool<a class="hash-link" href="#example-convert-pfx-to-java-key-store-using-keytool" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">param($result)  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># adapt paths and passwords as required</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$dest_password =&quot;ajkspassword&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$dest_jks_file=&quot;C:\temp\mykeystore.jks&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">C:\path\to\keytool -importkeystore -srckeystore $result.ManagedItem.CertificatePath -srcstoretype pkcs12 -destkeystore $dest_jks_file -deststoretype JKS -deststorepass $dest_password -srcstorepass &quot;&quot; </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="troubleshooting">Troubleshooting<a class="hash-link" href="#troubleshooting" title="Direct link to heading">​</a></h2><ul><li><p>In the Certify UI, you may test scripts by clicking the ▶ button. You should ideally test scripts after you have completed a successful certificate request so that you have real results and a certificate to work with.</p></li><li><p>The <code>$result.ManagedItem.CertificatePath</code> value will be set to the filename (including path) of the PFX file containing the requested certificate, unless the site is new and has not had a successful Certificate Request, in which case the value will not be set.</p></li><li><p>PowerShell Execution Policies may be set by your administrator which affect script execution. The app will try to set the policy to &quot;Unrestricted&quot; by default which may conflict with higher level policy settings. You can set the default script execution policy in the server settings file (then restart the Certify background service) <code>%PROGRAMDATA%\Certify\serviceconfig.json</code></p><ul><li><code>&quot;PowershellExecutionPolicy&quot;:&quot;Unrestricted&quot;</code> or</li><li><code>&quot;PowershellExecutionPolicy&quot;:&quot;Bypass&quot;</code> or</li><li><code>&quot;PowershellExecutionPolicy&quot;:&quot;&quot;</code> (blank string) to use the default policy set by your administrator.</li></ul></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/webprofusion/certify-docs/edit/master/docs/script-hooks.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/deployment/tasks_intro"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Deployment Tasks</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/guides/architecture/load-balancing"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Load Balanced Hosting</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#scripting-basics" class="table-of-contents__link toc-highlight">Scripting Basics</a></li><li><a href="#pre-request-tasks" class="table-of-contents__link toc-highlight">Pre-Request Tasks</a></li><li><a href="#deployment-tasks-post-request" class="table-of-contents__link toc-highlight">Deployment Tasks (Post-Request)</a><ul><li><a href="#example-output-the-result-properties-to-a-text-file" class="table-of-contents__link toc-highlight">Example: Output the result properties to a text file</a></li><li><a href="#example-send-email-via-gmail-after-unsuccessful-renewal" class="table-of-contents__link toc-highlight">Example: Send email via Gmail after unsuccessful renewal</a></li><li><a href="#example-restart-rras-after-successful-certificate-renewal" class="table-of-contents__link toc-highlight">Example: Restart RRAS after successful certificate renewal</a></li><li><a href="#example-convert-cng-certificate-storage-to-csp-for-exchange-2013" class="table-of-contents__link toc-highlight">Example: Convert CNG certificate storage to CSP (for Exchange 2013)</a></li><li><a href="#example-enable-certificate-for-exchange-2013--2016-services-on-local-server" class="table-of-contents__link toc-highlight">Example: Enable certificate for Exchange 2013 / 2016 services on local server</a></li><li><a href="#example-update-vmware-horizon-certificate" class="table-of-contents__link toc-highlight">Example: Update VMWare Horizon certificate</a></li><li><a href="#example-update-sql-server-connection-certificate" class="table-of-contents__link toc-highlight">Example: Update SQL Server connection certificate</a></li><li><a href="#example-update-sql-server-reporting-services" class="table-of-contents__link toc-highlight">Example: Update SQL Server Reporting Services</a></li><li><a href="#example-update-the-certificate-on-a-local-winrm-https-listener-windows-admin-center-etc" class="table-of-contents__link toc-highlight">Example: Update the certificate on a local WinRM https listener (Windows Admin Center etc)</a></li><li><a href="#example-convert-pfx-to-java-key-store-using-keytool" class="table-of-contents__link toc-highlight">Example: Convert PFX to Java Key Store using keytool</a></li></ul></li><li><a href="#troubleshooting" class="table-of-contents__link toc-highlight">Troubleshooting</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/certificate-process">Requesting a Certificate</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/faq">FAQ</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/support">Support</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://community.certifytheweb.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/webprofusion/certify" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://certifytheweb.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">certifytheweb.com<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/webprofusion/certify" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/certifytheweb" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Webprofusion Pty Ltd. Docs Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.5a0f8692.js"></script>
<script src="/assets/js/main.cb2383f5.js"></script>
</body>
</html>